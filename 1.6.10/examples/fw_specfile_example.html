
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Output scan(s) to a SPEC data file. &#8212; apstools 1.6.10 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/fw_specfile_example';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://raw.githubusercontent.com/BCDA-APS/apstools/main/docs/source/_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '1.6.10';
        </script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to Search for Bluesky Data?" href="ho_search_databroker.html" />
    <link rel="prev" title="Output scan(s) to a NeXus/HDF5 file" href="fw_nxwriter.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
  
    <p class="title logo__title">apstools 1.6.10 documentation</p>
  
</a>
    
    <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-toggle="dropdown">
        1.6.10  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../overview.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../applications/index.html">
                        Applications
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        Guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api/index.html">
                        API Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../install.html">
                        Installation
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../changes.html">
                        Change History
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../license.html">
                        License
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../overview.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../applications/index.html">
                        Applications
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        Guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api/index.html">
                        API Documentation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../install.html">
                        Installation
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../changes.html">
                        Change History
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../license.html">
                        License
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="de_0_adsim_hdf5_basic.html">Area Detector with default HDF5 File Name</a></li>
<li class="toctree-l1"><a class="reference internal" href="de_1_adsim_hdf5_custom_names.html">Area Detector with custom HDF5 File Name</a></li>
<li class="toctree-l1"><a class="reference internal" href="de_2_adsim_hdf5_single_mode.html">Area Detector, Single mode, HDF5 file</a></li>
<li class="toctree-l1"><a class="reference internal" href="de_ad_pe.html">ADPerkinElmer Area Detector with default HDF5 File Name</a></li>
<li class="toctree-l1"><a class="reference internal" href="de_ad_pilatus.html">ADPilatus Area Detector with default HDF5 File Name</a></li>
<li class="toctree-l1"><a class="reference internal" href="de_scaler_motor_flyer.html">Fly Scans with EPICS motor and scaler</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="fw_nxwriter.html">Output scan(s) to a NeXus/HDF5 file</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Output scan(s) to a SPEC data file.</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ho_search_databroker.html">How to Search for Bluesky Data?</a></li>
<li class="toctree-l1"><a class="reference internal" href="ho_session_logs.html">How to setup logging</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="pl_excel_scan.html">The <code class="docutils literal notranslate"><span class="pre">Excel_plan()</span></code> – batch scans using a spreadsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="pl_lineup.html">The <code class="docutils literal notranslate"><span class="pre">lineup()</span></code> plan - align an axis with a signal</a></li>
<li class="toctree-l1"><a class="reference internal" href="pl_nscan.html">The <code class="docutils literal notranslate"><span class="pre">nscan()</span></code> plan – scan multiple axes together</a></li>
<li class="toctree-l1"><a class="reference internal" href="pl_run_command_list.html">The <code class="xref py py-func docutils literal notranslate"><span class="pre">run_command_file()</span></code> plan – batch scans using a text file</a></li>
<li class="toctree-l1"><a class="reference internal" href="pl_tuneaxis.html">The <code class="docutils literal notranslate"><span class="pre">TuneAxis()</span></code> plan - align an axis with a signal</a></li>
</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Output-scan(s)-to-a-SPEC-data-file.">
<h1>Output scan(s) to a SPEC data file.<a class="headerlink" href="#Output-scan(s)-to-a-SPEC-data-file." title="Permalink to this heading">#</a></h1>
<p>One of the common concerns is how to access data from bluesky’s database. The standard way is to replay the document stream from each of the scans through a bluesky callback that writes the data to the desired file format. Here, we write data to the SPEC file format.</p>
<section id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this heading">#</a></h2>
<p>First, we must setup a bluesky session. We create a <a class="reference external" href="https://blueskyproject.io/databroker/how-to/file-backed-catalog.html?highlight=temporary#temporary-catalog">temporary catalog</a> to store the data from this notebook’s data collection.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span><span class="p">,</span> <span class="n">plans</span> <span class="k">as</span> <span class="n">bp</span>
<span class="kn">from</span> <span class="nn">bluesky.callbacks.best_effort</span> <span class="kn">import</span> <span class="n">BestEffortCallback</span>
<span class="kn">import</span> <span class="nn">databroker</span>

<span class="n">cat</span> <span class="o">=</span> <span class="n">databroker</span><span class="o">.</span><span class="n">temp</span><span class="p">()</span>
<span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">({})</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">insert</span><span class="p">)</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">BestEffortCallback</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1
</pre></div></div>
</div>
<p>We need to create some scan data. We’ll use Gaussian peak profile calculated in a <em>userCalc</em> (<code class="docutils literal notranslate"><span class="pre">swait</span></code> record) and a motor from our EPICS IOC simulator <code class="docutils literal notranslate"><span class="pre">gp:</span></code>. Initialize the peak computation with some randomized parameters. The peak will be at some <code class="docutils literal notranslate"><span class="pre">motor</span></code> position between -1 .. +1. Print the actual values for our reference later on.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">apstools.devices</span> <span class="kn">import</span> <span class="n">UserCalcN</span><span class="p">,</span> <span class="n">setup_gaussian_swait</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">EpicsMotor</span><span class="p">,</span> <span class="n">EpicsSignal</span>

<span class="n">IOC</span> <span class="o">=</span> <span class="s2">&quot;gp:&quot;</span>
<span class="n">motor</span> <span class="o">=</span> <span class="n">EpicsMotor</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">IOC</span><span class="si">}</span><span class="s2">m1&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;motor&quot;</span><span class="p">)</span>
<span class="n">swait</span> <span class="o">=</span> <span class="n">UserCalcN</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">IOC</span><span class="si">}</span><span class="s2">userCalc1&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;swait&quot;</span><span class="p">)</span>
<span class="n">det</span> <span class="o">=</span> <span class="n">EpicsSignal</span><span class="p">(</span><span class="n">swait</span><span class="o">.</span><span class="n">calculated_value</span><span class="o">.</span><span class="n">pvname</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;det&quot;</span><span class="p">)</span>

<span class="n">motor</span><span class="o">.</span><span class="n">wait_for_connection</span><span class="p">()</span>
<span class="n">swait</span><span class="o">.</span><span class="n">wait_for_connection</span><span class="p">()</span>
<span class="n">det</span><span class="o">.</span><span class="n">wait_for_connection</span><span class="p">()</span>

<span class="n">setup_gaussian_swait</span><span class="p">(</span>
    <span class="n">swait</span><span class="p">,</span> <span class="n">motor</span><span class="o">.</span><span class="n">user_readback</span><span class="p">,</span>
    <span class="n">center</span><span class="o">=-</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(),</span>
    <span class="n">width</span><span class="o">=</span><span class="mf">0.01</span> <span class="o">+</span> <span class="mf">0.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(),</span>
    <span class="n">noise</span><span class="o">=</span><span class="mf">0.05</span><span class="o">*</span><span class="p">(</span><span class="mf">.95</span> <span class="o">+</span> <span class="mf">.1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()),</span>
    <span class="n">scale</span><span class="o">=</span><span class="mi">100_000</span><span class="o">*</span><span class="p">(</span><span class="mf">.95</span> <span class="o">+</span> <span class="mf">.1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()),</span>
    <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;calc = </span><span class="si">{</span><span class="n">swait</span><span class="o">.</span><span class="n">calculation</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A: x = </span><span class="si">{</span><span class="n">swait</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">input_pv</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;B: center = </span><span class="si">{</span><span class="n">swait</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">input_value</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;C: width = </span><span class="si">{</span><span class="n">swait</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">input_value</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;D: scale = </span><span class="si">{</span><span class="n">swait</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">input_value</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;E: noise= </span><span class="si">{</span><span class="n">swait</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">input_value</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calc = D*(0.95+E*RNDM)/exp(((A-b)/c)^2)
A: x = gp:m1.RBV
B: center = -0.14563824029176498
C: width = 0.03019405564691883
D: scale = 100701.62331973032
E: noise= 0.049574955866745055
</pre></div></div>
</div>
<p>Finally, run the scan with the RunEngine:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">41</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Transient Scan ID: 1     Time: 2022-07-06 00:48:02
Persistent Unique Scan ID: &#39;7ab128a0-c0ef-4f41-a980-c5641e00ce97&#39;
New stream: &#39;primary&#39;
+-----------+------------+------------+------------+
|   seq_num |       time |      motor |        det |
+-----------+------------+------------+------------+
|         1 | 00:48:03.3 |   -1.20000 |    0.00000 |
|         2 | 00:48:03.5 |   -1.14000 |    0.00000 |
|         3 | 00:48:03.8 |   -1.08000 |    0.00000 |
|         4 | 00:48:04.1 |   -1.02000 |    0.00000 |
|         5 | 00:48:04.4 |   -0.96000 |    0.00000 |
|         6 | 00:48:04.8 |   -0.90000 |    0.00000 |
|         7 | 00:48:05.0 |   -0.84000 |    0.00000 |
|         8 | 00:48:05.4 |   -0.78000 |    0.00000 |
|         9 | 00:48:05.7 |   -0.72000 |    0.00000 |
|        10 | 00:48:06.0 |   -0.66000 |    0.00000 |
|        11 | 00:48:06.3 |   -0.60000 |    0.00000 |
|        12 | 00:48:06.6 |   -0.54000 |    0.00000 |
|        13 | 00:48:06.9 |   -0.48000 |    0.00000 |
|        14 | 00:48:07.2 |   -0.42000 |    0.00000 |
|        15 | 00:48:07.5 |   -0.36000 |    0.00000 |
|        16 | 00:48:07.8 |   -0.30000 |    0.00000 |
|        17 | 00:48:08.1 |   -0.24000 |    5.60768 |
|        18 | 00:48:08.4 |   -0.18000 | 27463.06109 |
|        19 | 00:48:08.7 |   -0.12000 | 48682.85376 |
|        20 | 00:48:09.0 |   -0.06000 |   31.30450 |
|        21 | 00:48:09.3 |    0.00000 |    0.00001 |
|        22 | 00:48:09.6 |    0.06000 |    0.00000 |
|        23 | 00:48:09.9 |    0.12000 |    0.00000 |
|        24 | 00:48:10.2 |    0.18000 |    0.00000 |
|        25 | 00:48:10.5 |    0.24000 |    0.00000 |
|        26 | 00:48:10.8 |    0.30000 |    0.00000 |
|        27 | 00:48:11.1 |    0.36000 |    0.00000 |
|        28 | 00:48:11.4 |    0.42000 |    0.00000 |
|        29 | 00:48:11.7 |    0.48000 |    0.00000 |
|        30 | 00:48:12.0 |    0.54000 |    0.00000 |
|        31 | 00:48:12.3 |    0.60000 |    0.00000 |
|        32 | 00:48:12.6 |    0.66000 |    0.00000 |
|        33 | 00:48:12.9 |    0.72000 |    0.00000 |
|        34 | 00:48:13.2 |    0.78000 |    0.00000 |
|        35 | 00:48:13.5 |    0.84000 |    0.00000 |
|        36 | 00:48:13.8 |    0.90000 |    0.00000 |
|        37 | 00:48:14.1 |    0.96000 |    0.00000 |
|        38 | 00:48:14.4 |    1.02000 |    0.00000 |
|        39 | 00:48:14.7 |    1.08000 |    0.00000 |
|        40 | 00:48:15.0 |    1.14000 |    0.00000 |
|        41 | 00:48:15.3 |    1.20000 |    0.00000 |
+-----------+------------+------------+------------+
generator scan [&#39;7ab128a0&#39;] (scan num: 1)



</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;7ab128a0-c0ef-4f41-a980-c5641e00ce97&#39;,)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_fw_specfile_example_6_2.png" src="../_images/examples_fw_specfile_example_6_2.png" />
</div>
</div>
</section>
<section id="get-the-most-recent-scan,-by-steps">
<h2>get the most recent scan, by steps<a class="headerlink" href="#get-the-most-recent-scan,-by-steps" title="Permalink to this heading">#</a></h2>
<p>The databroker instance, <code class="docutils literal notranslate"><span class="pre">cat</span></code>, provides access to its scans by several means. One way is to consider <code class="docutils literal notranslate"><span class="pre">cat</span></code> as a list and retrieve the last item from the list. This will return a <em>run</em>, the common reference to be used.</p>
<p>For this first example, we’ll work through the steps one by one. The <code class="docutils literal notranslate"><span class="pre">cat.v2</span></code> interface is the easiest to use (at this writing).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">v2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">run</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
BlueskyRun
  uid=&#39;7ab128a0-c0ef-4f41-a980-c5641e00ce97&#39;
  exit_status=&#39;success&#39;
  2022-07-06 00:48:02.921 -- 2022-07-06 00:48:15.351
  Streams:
    * primary

</pre></div></div>
</div>
<p>As shown, the run has one data stream, name <code class="docutils literal notranslate"><span class="pre">primary</span></code>. The databroker provides a simple table view of this run:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run</span><span class="o">.</span><span class="n">primary</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:              (time: 41)
Coordinates:
  * time                 (time) float64 1.657e+09 1.657e+09 ... 1.657e+09
Data variables:
    motor                (time) float64 -1.2 -1.14 -1.08 -1.02 ... 1.08 1.14 1.2
    motor_user_setpoint  (time) float64 -1.2 -1.14 -1.08 -1.02 ... 1.08 1.14 1.2
    det                  (time) float64 0.0 0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-809e1f78-4fd5-4d2a-84f8-a7cd7c3a7e02' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-809e1f78-4fd5-4d2a-84f8-a7cd7c3a7e02' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 41</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-b5eb2f72-484a-4eb3-930b-d4df0dd16281' class='xr-section-summary-in' type='checkbox'  checked><label for='section-b5eb2f72-484a-4eb3-930b-d4df0dd16281' class='xr-section-summary' >Coordinates: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.657e+09 1.657e+09 ... 1.657e+09</div><input id='attrs-b1912f36-87cb-4a2d-966a-f4ed0ac4f39b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b1912f36-87cb-4a2d-966a-f4ed0ac4f39b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f0226684-d0f6-48b4-820f-0d0b1f67e31b' class='xr-var-data-in' type='checkbox'><label for='data-f0226684-d0f6-48b4-820f-0d0b1f67e31b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1.657086e+09, 1.657086e+09, 1.657086e+09, 1.657086e+09, 1.657086e+09,
       1.657086e+09, 1.657086e+09, 1.657086e+09, 1.657086e+09, 1.657086e+09,
       1.657086e+09, 1.657086e+09, 1.657086e+09, 1.657086e+09, 1.657086e+09,
       1.657086e+09, 1.657086e+09, 1.657086e+09, 1.657086e+09, 1.657086e+09,
       1.657086e+09, 1.657086e+09, 1.657086e+09, 1.657086e+09, 1.657086e+09,
       1.657086e+09, 1.657086e+09, 1.657086e+09, 1.657086e+09, 1.657086e+09,
       1.657086e+09, 1.657086e+09, 1.657086e+09, 1.657086e+09, 1.657086e+09,
       1.657086e+09, 1.657086e+09, 1.657086e+09, 1.657086e+09, 1.657086e+09,
       1.657086e+09])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-2d229ba9-cef4-43cb-b1ba-ba62ad43940c' class='xr-section-summary-in' type='checkbox'  checked><label for='section-2d229ba9-cef4-43cb-b1ba-ba62ad43940c' class='xr-section-summary' >Data variables: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>motor</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-1.2 -1.14 -1.08 ... 1.08 1.14 1.2</div><input id='attrs-9b8fe92d-d893-4190-83ca-602aad465e1e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-9b8fe92d-d893-4190-83ca-602aad465e1e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c8c2a9b2-4a23-4afe-a231-eab351476937' class='xr-var-data-in' type='checkbox'><label for='data-c8c2a9b2-4a23-4afe-a231-eab351476937' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>object :</span></dt><dd>motor</dd></dl></div><div class='xr-var-data'><pre>array([-1.2 , -1.14, -1.08, -1.02, -0.96, -0.9 , -0.84, -0.78, -0.72,
       -0.66, -0.6 , -0.54, -0.48, -0.42, -0.36, -0.3 , -0.24, -0.18,
       -0.12, -0.06,  0.  ,  0.06,  0.12,  0.18,  0.24,  0.3 ,  0.36,
        0.42,  0.48,  0.54,  0.6 ,  0.66,  0.72,  0.78,  0.84,  0.9 ,
        0.96,  1.02,  1.08,  1.14,  1.2 ])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>motor_user_setpoint</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-1.2 -1.14 -1.08 ... 1.08 1.14 1.2</div><input id='attrs-db9ce1c6-85a9-4e3f-b8bf-ee24719effb8' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-db9ce1c6-85a9-4e3f-b8bf-ee24719effb8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e8e5221d-bfa8-48f5-a2a0-bcbd5aa922ac' class='xr-var-data-in' type='checkbox'><label for='data-e8e5221d-bfa8-48f5-a2a0-bcbd5aa922ac' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>object :</span></dt><dd>motor</dd></dl></div><div class='xr-var-data'><pre>array([-1.2 , -1.14, -1.08, -1.02, -0.96, -0.9 , -0.84, -0.78, -0.72,
       -0.66, -0.6 , -0.54, -0.48, -0.42, -0.36, -0.3 , -0.24, -0.18,
       -0.12, -0.06,  0.  ,  0.06,  0.12,  0.18,  0.24,  0.3 ,  0.36,
        0.42,  0.48,  0.54,  0.6 ,  0.66,  0.72,  0.78,  0.84,  0.9 ,
        0.96,  1.02,  1.08,  1.14,  1.2 ])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>det</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0</div><input id='attrs-579c8e8c-e932-40f2-8478-105e601df700' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-579c8e8c-e932-40f2-8478-105e601df700' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c6621714-19f1-4d19-b590-14da5eb235d3' class='xr-var-data-in' type='checkbox'><label for='data-c6621714-19f1-4d19-b590-14da5eb235d3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>object :</span></dt><dd>det</dd></dl></div><div class='xr-var-data'><pre>array([0.00000000e+000, 0.00000000e+000, 0.00000000e+000, 0.00000000e+000,
       0.00000000e+000, 8.15929807e-267, 2.12005578e-225, 1.99156532e-187,
       7.05556770e-153, 9.22836571e-122, 4.49803156e-094, 8.03462395e-070,
       5.54084085e-049, 1.35128221e-031, 1.24897894e-017, 4.45654099e-007,
       5.60767888e+000, 2.74630611e+004, 4.86828538e+004, 3.13045008e+001,
       7.83939738e-006, 7.13667053e-016, 2.33101349e-029, 2.98521439e-046,
       1.39436720e-066, 2.41578388e-090, 1.54722740e-117, 3.74387074e-148,
       3.38335937e-182, 1.14251231e-219, 1.37922084e-260, 0.00000000e+000,
       0.00000000e+000, 0.00000000e+000, 0.00000000e+000, 0.00000000e+000,
       0.00000000e+000, 0.00000000e+000, 0.00000000e+000, 0.00000000e+000,
       0.00000000e+000])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-6d8ff466-1c6b-47f7-a084-57e117741e1c' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-6d8ff466-1c6b-47f7-a084-57e117741e1c' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div>
</div>
</section>
<section id="Support-function:-specfile_example()">
<h2>Support function: <code class="docutils literal notranslate"><span class="pre">specfile_example()</span></code><a class="headerlink" href="#Support-function:-specfile_example()" title="Permalink to this heading">#</a></h2>
<p>We need to call the <code class="docutils literal notranslate"><span class="pre">apstools.callbacks.SpecWriterCallback()</span></code> callback with the run’s documents.</p>
<p>Here, <code class="docutils literal notranslate"><span class="pre">specfile_example()</span></code> is a support function that can be used with one or more runs to create a SPEC data file (one Bluesky run will become one SPEC scan in the same file).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">apstools.callbacks</span> <span class="kn">import</span> <span class="n">SpecWriterCallback</span>
<span class="kn">from</span> <span class="nn">databroker._drivers.mongo_normalized</span> <span class="kn">import</span> <span class="n">BlueskyMongoCatalog</span>
<span class="kn">from</span> <span class="nn">databroker._drivers.msgpack</span> <span class="kn">import</span> <span class="n">BlueskyMsgpackCatalog</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">DEMO_SPEC_FILE</span> <span class="o">=</span> <span class="s2">&quot;test_specdata.txt&quot;</span>

<span class="k">def</span> <span class="nf">specfile_example</span><span class="p">(</span><span class="n">runs</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">DEMO_SPEC_FILE</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;write one or more headers (scans) to a SPEC data file&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">runs</span><span class="p">,</span> <span class="n">databroker</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BlueskyRun</span><span class="p">):</span>
        <span class="n">runs</span> <span class="o">=</span> <span class="p">[</span><span class="n">runs</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">runs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">BlueskyMsgpackCatalog</span><span class="p">,</span> <span class="n">BlueskyMongoCatalog</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Must give run object or list of run objects.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must provide one or more runs.&quot;</span><span class="p">)</span>

    <span class="n">specwriter</span> <span class="o">=</span> <span class="n">SpecWriterCallback</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">auto_write</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">run</span> <span class="o">=</span> <span class="n">runs</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">run</span> <span class="o">=</span> <span class="n">uid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="n">databroker</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BlueskyRun</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping </span><span class="si">{</span><span class="n">run</span><span class="si">=}</span><span class="s2">, it is not a BlueskyRun object.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="c1"># to get the raw document stream, need the v1 interface</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">catalog_object</span><span class="o">.</span><span class="n">v1</span><span class="p">[</span><span class="n">run</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>  <span class="c1"># header</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_documents</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
            <span class="n">specwriter</span><span class="o">.</span><span class="n">receiver</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span>
        <span class="c1"># lines = specwriter.prepare_scan_contents()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Look at SPEC data file: &quot;</span> <span class="o">+</span> <span class="n">specwriter</span><span class="o">.</span><span class="n">spec_filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Write-the-run-as-SPEC-data">
<h2>Write the run as SPEC data<a class="headerlink" href="#Write-the-run-as-SPEC-data" title="Permalink to this heading">#</a></h2>
<p>Let’s write it as a SPEC data file (namely: <code class="docutils literal notranslate"><span class="pre">spec1.dat</span></code>):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;spec1.dat&quot;</span><span class="p">):</span>  <span class="c1"># re-write the file</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;spec1.dat&quot;</span><span class="p">)</span>

<span class="n">specfile_example</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;spec1.dat&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Look at SPEC data file: spec1.dat
</pre></div></div>
</div>
<p>Let’s view file <code class="docutils literal notranslate"><span class="pre">spec1.dat</span></code> from disk storage (using the <code class="docutils literal notranslate"><span class="pre">`pycat</span></code> &lt;<a class="reference external" href="https://ipython.readthedocs.io/en/stable/interactive/magics.html?highlight=pycat#magic-pycat">https://ipython.readthedocs.io/en/stable/interactive/magics.html?highlight=pycat#magic-pycat</a>&gt;`__ IPython magic function):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">pycat</span> spec1.dat
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">#F spec1.dat</span>
<span class="ansi-red-fg">#E 1657086495</span>
<span class="ansi-red-fg">#D Wed Jul 06 00:48:15 2022</span>
<span class="ansi-red-fg">#C Bluesky  user = prjemian  host = zap</span>
<span class="ansi-red-fg">#O0 </span>
<span class="ansi-red-fg">#o0 </span>

<span class="ansi-red-fg">#S 1  scan(detectors=[&#39;det&#39;], num=41, args=&#39;[&#39;motor&#39;, -1.2, 1.2]&#39;, per_step=&#39;None&#39;)</span>
<span class="ansi-red-fg">#D Wed Jul 06 00:48:02 2022</span>
<span class="ansi-red-fg">#C Wed Jul 06 00:48:02 2022.  plan_type = generator</span>
<span class="ansi-red-fg">#C Wed Jul 06 00:48:02 2022.  uid = 7ab128a0-c0ef-4f41-a980-c5641e00ce97</span>
<span class="ansi-red-fg">#MD uid = 7ab128a0-c0ef-4f41-a980-c5641e00ce97</span>
<span class="ansi-red-fg">#MD detectors = [&#39;det&#39;]</span>
<span class="ansi-red-fg">#MD motors = [&#39;motor&#39;]</span>
<span class="ansi-red-fg">#MD num_intervals = 40</span>
<span class="ansi-red-fg">#MD num_points = 41</span>
<span class="ansi-red-fg">#MD plan_pattern = inner_product</span>
<span class="ansi-red-fg">#MD plan_pattern_args = {&#39;num&#39;: 41, &#39;args&#39;: [&#34;EpicsMotor(prefix=&#39;gp:m1&#39;, name=&#39;motor&#39;, settle_time=0.0, timeout=None, read_attrs=[&#39;user_readback&#39;, &#39;user_setpoint&#39;], configuration_attrs=[&#39;user_offset&#39;, &#39;user_offset_dir&#39;, &#39;velocity&#39;, &#39;acceleration&#39;, &#39;motor_egu&#39;])&#34;, -1.2, 1.2]}</span>
<span class="ansi-red-fg">#MD plan_pattern_module = bluesky.plan_patterns</span>
<span class="ansi-red-fg">#MD versions = {&#39;ophyd&#39;: &#39;1.6.4&#39;, &#39;bluesky&#39;: &#39;1.8.3&#39;}</span>
<span class="ansi-red-fg">#P0 </span>
<span class="ansi-red-fg">#N 5</span>
<span class="ansi-red-fg">#L motor  Epoch_float  Epoch  motor_user_setpoint  det</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1.2</span> <span class="ansi-cyan-fg">0.434417724609375</span> <span class="ansi-cyan-fg">0</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1.2</span> <span class="ansi-cyan-fg">0.0</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1.1400000000000001</span> <span class="ansi-cyan-fg">0.6748816967010498</span> <span class="ansi-cyan-fg">1</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1.14</span> <span class="ansi-cyan-fg">0.0</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1.08</span> <span class="ansi-cyan-fg">0.9758017063140869</span> <span class="ansi-cyan-fg">1</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1.08</span> <span class="ansi-cyan-fg">0.0</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1.02</span> <span class="ansi-cyan-fg">1.276907205581665</span> <span class="ansi-cyan-fg">1</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1.02</span> <span class="ansi-cyan-fg">0.0</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.96</span> <span class="ansi-cyan-fg">1.577857255935669</span> <span class="ansi-cyan-fg">2</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.96</span> <span class="ansi-cyan-fg">0.0</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.9</span> <span class="ansi-cyan-fg">1.878566026687622</span> <span class="ansi-cyan-fg">2</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.8999999999999999</span> <span class="ansi-cyan-fg">8.15929807366173e-267</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.84</span> <span class="ansi-cyan-fg">2.1784615516662598</span> <span class="ansi-cyan-fg">2</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.84</span> <span class="ansi-cyan-fg">2.1200557806170912e-225</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.78</span> <span class="ansi-cyan-fg">2.479753255844116</span> <span class="ansi-cyan-fg">2</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.78</span> <span class="ansi-cyan-fg">1.9915653174496467e-187</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.72</span> <span class="ansi-cyan-fg">2.7803871631622314</span> <span class="ansi-cyan-fg">3</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.72</span> <span class="ansi-cyan-fg">7.055567703307068e-153</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.66</span> <span class="ansi-cyan-fg">3.084782361984253</span> <span class="ansi-cyan-fg">3</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.6599999999999999</span> <span class="ansi-cyan-fg">9.228365714083866e-122</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.6</span> <span class="ansi-cyan-fg">3.38234806060791</span> <span class="ansi-cyan-fg">3</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.6</span> <span class="ansi-cyan-fg">4.4980315558799814e-94</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.54</span> <span class="ansi-cyan-fg">3.683393955230713</span> <span class="ansi-cyan-fg">4</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.54</span> <span class="ansi-cyan-fg">8.034623946332195e-70</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.48</span> <span class="ansi-cyan-fg">3.983243703842163</span> <span class="ansi-cyan-fg">4</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.48</span> <span class="ansi-cyan-fg">5.540840853688821e-49</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.42</span> <span class="ansi-cyan-fg">4.28428053855896</span> <span class="ansi-cyan-fg">4</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.41999999999999993</span> <span class="ansi-cyan-fg">1.3512822090579629e-31</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.36</span> <span class="ansi-cyan-fg">4.585167646408081</span> <span class="ansi-cyan-fg">5</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.36</span> <span class="ansi-cyan-fg">1.2489789444505279e-17</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.3</span> <span class="ansi-cyan-fg">4.885620355606079</span> <span class="ansi-cyan-fg">5</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.30000000000000004</span> <span class="ansi-cyan-fg">4.456540993798201e-07</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.24</span> <span class="ansi-cyan-fg">5.186397314071655</span> <span class="ansi-cyan-fg">5</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.24</span> <span class="ansi-cyan-fg">5.607678879044609</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.18</span> <span class="ansi-cyan-fg">5.481502294540405</span> <span class="ansi-cyan-fg">5</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.17999999999999994</span> <span class="ansi-cyan-fg">27463.061094278986</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.12</span> <span class="ansi-cyan-fg">5.787712335586548</span> <span class="ansi-cyan-fg">6</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.11999999999999988</span> <span class="ansi-cyan-fg">48682.85376123283</span>
<span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.06</span> <span class="ansi-cyan-fg">6.08820915222168</span> <span class="ansi-cyan-fg">6</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">0.06000000000000005</span> <span class="ansi-cyan-fg">31.30450080779168</span>
<span class="ansi-cyan-fg">0.0</span> <span class="ansi-cyan-fg">6.389137268066406</span> <span class="ansi-cyan-fg">6</span> <span class="ansi-cyan-fg">0.0</span> <span class="ansi-cyan-fg">7.839397376237093e-06</span>
<span class="ansi-cyan-fg">0.06</span> <span class="ansi-cyan-fg">6.690355062484741</span> <span class="ansi-cyan-fg">7</span> <span class="ansi-cyan-fg">0.06000000000000005</span> <span class="ansi-cyan-fg">7.136670527501498e-16</span>
<span class="ansi-cyan-fg">0.12</span> <span class="ansi-cyan-fg">6.991316556930542</span> <span class="ansi-cyan-fg">7</span> <span class="ansi-cyan-fg">0.11999999999999988</span> <span class="ansi-cyan-fg">2.3310134905397063e-29</span>
<span class="ansi-cyan-fg">0.18</span> <span class="ansi-cyan-fg">7.291990041732788</span> <span class="ansi-cyan-fg">7</span> <span class="ansi-cyan-fg">0.17999999999999994</span> <span class="ansi-cyan-fg">2.985214388500194e-46</span>
<span class="ansi-cyan-fg">0.24</span> <span class="ansi-cyan-fg">7.593103885650635</span> <span class="ansi-cyan-fg">8</span> <span class="ansi-cyan-fg">0.24</span> <span class="ansi-cyan-fg">1.394367198136051e-66</span>
<span class="ansi-cyan-fg">0.3</span> <span class="ansi-cyan-fg">7.893867492675781</span> <span class="ansi-cyan-fg">8</span> <span class="ansi-cyan-fg">0.30000000000000004</span> <span class="ansi-cyan-fg">2.415783879435812e-90</span>
<span class="ansi-cyan-fg">0.36</span> <span class="ansi-cyan-fg">8.195511817932129</span> <span class="ansi-cyan-fg">8</span> <span class="ansi-cyan-fg">0.3600000000000001</span> <span class="ansi-cyan-fg">1.5472274009149628e-117</span>
<span class="ansi-cyan-fg">0.42</span> <span class="ansi-cyan-fg">8.495795965194702</span> <span class="ansi-cyan-fg">8</span> <span class="ansi-cyan-fg">0.41999999999999993</span> <span class="ansi-cyan-fg">3.743870737982315e-148</span>
<span class="ansi-cyan-fg">0.48</span> <span class="ansi-cyan-fg">8.796814680099487</span> <span class="ansi-cyan-fg">9</span> <span class="ansi-cyan-fg">0.48</span> <span class="ansi-cyan-fg">3.383359371335557e-182</span>
<span class="ansi-cyan-fg">0.54</span> <span class="ansi-cyan-fg">9.097584009170532</span> <span class="ansi-cyan-fg">9</span> <span class="ansi-cyan-fg">0.54</span> <span class="ansi-cyan-fg">1.1425123138669685e-219</span>
<span class="ansi-cyan-fg">0.6</span> <span class="ansi-cyan-fg">9.399116039276123</span> <span class="ansi-cyan-fg">9</span> <span class="ansi-cyan-fg">0.5999999999999999</span> <span class="ansi-cyan-fg">1.3792208368358542e-260</span>
<span class="ansi-cyan-fg">0.66</span> <span class="ansi-cyan-fg">9.699814081192017</span> <span class="ansi-cyan-fg">10</span> <span class="ansi-cyan-fg">0.6599999999999999</span> <span class="ansi-cyan-fg">0.0</span>
<span class="ansi-cyan-fg">0.72</span> <span class="ansi-cyan-fg">10.001182079315186</span> <span class="ansi-cyan-fg">10</span> <span class="ansi-cyan-fg">0.72</span> <span class="ansi-cyan-fg">0.0</span>
<span class="ansi-cyan-fg">0.78</span> <span class="ansi-cyan-fg">10.301761150360107</span> <span class="ansi-cyan-fg">10</span> <span class="ansi-cyan-fg">0.78</span> <span class="ansi-cyan-fg">0.0</span>
<span class="ansi-cyan-fg">0.84</span> <span class="ansi-cyan-fg">10.603094100952148</span> <span class="ansi-cyan-fg">11</span> <span class="ansi-cyan-fg">0.8400000000000001</span> <span class="ansi-cyan-fg">0.0</span>
<span class="ansi-cyan-fg">0.9</span> <span class="ansi-cyan-fg">10.904242992401123</span> <span class="ansi-cyan-fg">11</span> <span class="ansi-cyan-fg">0.9000000000000001</span> <span class="ansi-cyan-fg">0.0</span>
<span class="ansi-cyan-fg">0.96</span> <span class="ansi-cyan-fg">11.205401420593262</span> <span class="ansi-cyan-fg">11</span> <span class="ansi-cyan-fg">0.9600000000000002</span> <span class="ansi-cyan-fg">0.0</span>
<span class="ansi-cyan-fg">1.02</span> <span class="ansi-cyan-fg">11.506523370742798</span> <span class="ansi-cyan-fg">12</span> <span class="ansi-cyan-fg">1.0199999999999998</span> <span class="ansi-cyan-fg">0.0</span>
<span class="ansi-cyan-fg">1.08</span> <span class="ansi-cyan-fg">11.807251930236816</span> <span class="ansi-cyan-fg">12</span> <span class="ansi-cyan-fg">1.0799999999999998</span> <span class="ansi-cyan-fg">0.0</span>
<span class="ansi-cyan-fg">1.1400000000000001</span> <span class="ansi-cyan-fg">12.102661371231079</span> <span class="ansi-cyan-fg">12</span> <span class="ansi-cyan-fg">1.14</span> <span class="ansi-cyan-fg">0.0</span>
<span class="ansi-cyan-fg">1.2</span> <span class="ansi-cyan-fg">12.408974170684814</span> <span class="ansi-cyan-fg">12</span> <span class="ansi-cyan-fg">1.2</span> <span class="ansi-cyan-fg">0.0</span>
<span class="ansi-red-fg">#C Wed Jul 06 00:48:15 2022.  num_events_primary = 41</span>
<span class="ansi-red-fg">#C Wed Jul 06 00:48:15 2022.  exit_status = success</span>

</pre></div></div>
</div>
<p>We see that the output of the <code class="docutils literal notranslate"><span class="pre">specfile_example()</span></code> command includes the content of the SPEC file. For the remaining examples, we’ll skip this additional step to view the SPEC file contents from disk.</p>
</section>
<section id="a-specific-scan">
<h2>a specific scan<a class="headerlink" href="#a-specific-scan" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">cat</span></code> object allows us to access scans by UUID (or any shorter version that remains unique in the database). We show an example but have commented it out since those runs do not exist in our temporary databroker catalog.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># specfile_example(cat[&quot;37c188c0&quot;], filename=&quot;spec3.dat&quot;)</span>
</pre></div>
</div>
</div>
</section>
<section id="specify-a-list-of-scans-by-UID">
<h2>specify a list of scans by UID<a class="headerlink" href="#specify-a-list-of-scans-by-UID" title="Permalink to this heading">#</a></h2>
<p>Suppose we have a list of scans where we know the UID of each one, we can build a list of headers and write a SPEC data file with that list. Here, we have such a list of tuning scans. We show an example but have commented it out since those runs do not exist in our temporary databroker catalog.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># runs = [cat[uid] for uid in &quot;957d83c c354fe37-e39f 42c&quot;.split()]</span>
<span class="c1"># specfile_example(runs, filename=&quot;spec_tunes.dat&quot;)</span>
</pre></div>
</div>
</div>
</section>
<section id="Find-specific-plans-within-a-range-of-dates">
<h2>Find specific plans within a range of dates<a class="headerlink" href="#Find-specific-plans-within-a-range-of-dates" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">cat</span></code> object allows for filtering arguments based on any keywords in the <em>start</em> document and also by time. Here, we filter between certain dates and also by <code class="docutils literal notranslate"><span class="pre">plan</span> <span class="pre">name</span></code>. The dates are specified in <a class="reference external" href="https://www.iso.org/iso-8601-date-and-time-format.html">ISO8601 format</a> and can include precision beyond a millisecond. Here, we use the <code class="docutils literal notranslate"><span class="pre">v2</span></code> interface to do the searches. We show examples how to pick between a set of dates.</p>
<p>Also, we write to the default data file: <code class="docutils literal notranslate"><span class="pre">test_specdata.txt</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">databroker.queries</span> <span class="kn">import</span> <span class="n">TimeRange</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;test_specdata.txt&quot;</span><span class="p">):</span>  <span class="c1"># re-write the file</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;test_specdata.txt&quot;</span><span class="p">)</span>

<span class="n">query</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">query</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TimeRange</span><span class="p">(</span><span class="n">since</span><span class="o">=</span><span class="s2">&quot;2019-02-19 17:00&quot;</span><span class="p">))</span>
<span class="n">query</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TimeRange</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="s2">&quot;2032-02-19 17:11:30&quot;</span><span class="p">))</span>
<span class="n">query</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">plan_name</span><span class="o">=</span><span class="s2">&quot;scan&quot;</span><span class="p">))</span>

<span class="n">runs</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
    <span class="n">run</span> <span class="o">=</span> <span class="n">runs</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">][</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
    <span class="n">isodate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">uid</span><span class="p">[:</span><span class="mi">8</span><span class="p">],</span> <span class="n">isodate</span><span class="p">)</span>
<span class="n">specfile_example</span><span class="p">(</span><span class="n">runs</span><span class="p">,</span> <span class="s2">&quot;test_specdata.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/prjemian/micromamba/envs/bluesky_2022_3/lib/python3.9/site-packages/databroker/queries.py:89: PytzUsageWarning: The zone attribute is specific to pytz&#39;s interface; please migrate to a new time zone provider. For more details on how to do so, see https://pytz-deprecation-shim.readthedocs.io/en/latest/migration.html
  timezone = lz.zone
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
7ab128a0 2022-07-06 00:48:02.921515
Look at SPEC data file: test_specdata.txt
</pre></div></div>
</div>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="fw_nxwriter.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Output scan(s) to a NeXus/HDF5 file</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="ho_search_databroker.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">How to Search for Bluesky Data?</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Setup">
   Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-the-most-recent-scan,-by-steps">
   get the most recent scan, by steps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Support-function:-specfile_example()">
   Support function:
   <code class="docutils literal notranslate">
    <span class="pre">
     specfile_example()
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Write-the-run-as-SPEC-data">
   Write the run as SPEC data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-specific-scan">
   a specific scan
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#specify-a-list-of-scans-by-UID">
   specify a list of scans by UID
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Find-specific-plans-within-a-range-of-dates">
   Find specific plans within a range of dates
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../_sources/examples/fw_specfile_example.ipynb.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2017-2023, UChicago Argonne, LLC.<br>

</p>

  </div>
  
  <div class="footer-item">
    <p class="theme-version">
    Built with the
    <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">
        PyData Sphinx Theme
    </a>
    0.12.0.
</p>
  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>